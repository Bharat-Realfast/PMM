<template>
    <lightning-card>
        <!-- Lightning Card Header -->
        <div
            class="slds-border_bottom slds-var-p-left_small slds-var-p-bottom_small slds-var-p-top_xxx-small"
        >
            <h1 slot="title" class="header-title-container slds-card__header-title">
                {labels.recentSessions}
            </h1>
            <div>
                <lightning-button-menu
                    variant="container"
                    class="listViewSelector"
                    label={selectedMenuItemLabel}
                    onselect={handleMenuItemSelected}
                >
                    <template for:each={menuItems} for:item="menuItem">
                        <lightning-menu-item
                            label={menuItem.label}
                            value={menuItem.value}
                            key={menuItem.label}
                            checked={menuItem.isChecked}
                        ></lightning-menu-item>
                    </template>
                </lightning-button-menu>
            </div>
        </div>

        <!-- Lightning Card Body -->

        <div
            class="component-height slds-scrollable_y"
            style="margin-bottom: 0px;background-color:#f3f2f2"
        >
            <lightning-spinner
                alternative-text={labels.loading}
                size="small"
                if:false={hasLoaded}
            ></lightning-spinner>
            <template
                for:each={sessionsData}
                for:item="sessionData"
                if:true={sessionsData}
            >
                <c-accordion-section
                    class="slds-var-p-right_small relative-container"
                    key={sessionData.sessionStartDate}
                    open-current-section={sessionData.openCurrentSection}
                >
                    <div
                        slot="clickableHeaderSection"
                        style="font-size: 14px;"
                        class="slds-var-p-left_x-small"
                    >
                        {sessionData.sessionStartDate}
                    </div>
                    <div slot="extraInfoSection" class="slds-var-p-left_xxx-small">
                        {sessionData.totalSessions}
                    </div>

                    <c-skip-links>
                        <lightning-layout horizontal-align="spread" multiple-rows="true">
                            <template for:each={sessionData.sessions} for:item="session">
                                <lightning-layout-item
                                    size={sessionsContainerDefaultSize}
                                    key={session.Id}
                                    medium-device-size={sessionsContainerMediumSize}
                                    large-device-size={sessionsContainerLargeSize}
                                    padding={sessionsContainerPaddingAround}
                                >
                                    <!-- Session card starts here -->
                                    <!-- TODO: Pull this below code into a separate component -->
                                    <lightning-record-view-form
                                        record-id={session.Id}
                                        object-api-name={serviceSessionObject}
                                        key={session.Id}
                                        density="compact"
                                    >
                                        <lightning-layout
                                            class="slds-box small-box slds-var-m-top_x-small slds-theme_default"
                                            multiple-rows="true"
                                        >
                                            <lightning-layout-item size="8">
                                                <a href="#">{session.Name} </a>
                                            </lightning-layout-item>
                                            <lightning-layout-item
                                                size="4"
                                                class="slds-list_horizontal slds-align_absolute-center"
                                                flexibility="no-grow,no-shrink"
                                            >
                                                <lightning-icon
                                                    tabindex="0"
                                                    icon-name="utility:success"
                                                    alternative-text={labels.success}
                                                    size="x-small"
                                                    variant="success"
                                                    title={labels.success}
                                                    if:true={session.showCompleteIcon}
                                                ></lightning-icon>
                                                <lightning-icon
                                                    tabindex="0"
                                                    icon-name="utility:clock"
                                                    size="x-small"
                                                    if:false={session.showCompleteIcon}
                                                ></lightning-icon>
                                                <lightning-output-field
                                                    field-name={fields.status}
                                                    variant="label-hidden"
                                                    class="slds-var-p-left_x-small"
                                                >
                                                </lightning-output-field>
                                            </lightning-layout-item>
                                            <lightning-layout-item
                                                size="12"
                                                class="slds-var-m-top_xxx-small slds-list_horizontal"
                                            >
                                                <div>
                                                    <lightning-formatted-date-time
                                                        value={session.sessionStartDate}
                                                        hour="2-digit"
                                                        minute="2-digit"
                                                        time-zone={timeZone}
                                                    ></lightning-formatted-date-time>
                                                    <span
                                                        class="slds-var-p-left_x-small slds-var-p-right_x-small"
                                                        >|</span
                                                    >
                                                    <span>{session.serviceName}</span>
                                                </div>
                                            </lightning-layout-item>

                                            <lightning-layout-item
                                                size="12"
                                                class="slds-list_horizontal slds-var-m-top_x-small"
                                            >
                                                <lightning-icon
                                                    tabindex="0"
                                                    icon-name="utility:user"
                                                    size="x-small"
                                                    if:true={session.showPrimaryServiceProviderIcon}
                                                ></lightning-icon>
                                                <lightning-output-field
                                                    field-name={fields.primaryServiceProvider}
                                                    variant="label-hidden"
                                                    class="slds-var-p-left_x-small"
                                                >
                                                </lightning-output-field>
                                            </lightning-layout-item>
                                        </lightning-layout>
                                    </lightning-record-view-form>
                                </lightning-layout-item>
                            </template>
                        </lightning-layout>
                    </c-skip-links>
                </c-accordion-section>
            </template>
        </div>
    </lightning-card>
</template>
